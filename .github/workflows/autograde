import io
import importlib
import os
import sys

import pytest


module_name = "helloworld"


def test_script_exists():
    curr_dir = os.getcwd()
    accepted_subfolders = ["src"]
    for subfolder in accepted_subfolders:
        filename = os.path.join(curr_dir, subfolder, f'{module_name}.py')
        if os.path.exists(filename):
            assert True
            return
        print(f"Not found: {filename}")
    new_line = "\n"
    assert False, (f"{module_name}.py was not found.\n"
                   "Make sure it is in an accepted subfolder below:\n"
                   f"{new_line.join(accepted_subfolders)}")


def test_correct_output(monkeypatch):
    mocked_stdout = io.StringIO()
    with monkeypatch.context() as mock_context:
        mock_context.setattr(sys, "stdout", mocked_stdout)
        sys.modules.pop(module_name, None)
        importlib.import_module(name=module_name)
    expected_result = ("Hello World!\n")
    assert mocked_stdout.getvalue() == expected_result, ("Incorrect output!")
